{
  "request": {
    "requestId": "69b1d401-8bbf-4dda-b9aa-6487e559635c",
    "requestNumber": 220,
    "timestamp": "2025-10-24T18:53:09.003Z",
    "method": "POST",
    "path": "/v1/chat/completions",
    "headers": {
      "content-length": "12663",
      "accept": "application/json",
      "content-type": "application/json",
      "user-agent": "OpenAI/JS 4.104.0",
      "x-stainless-lang": "js",
      "x-stainless-package-version": "4.104.0",
      "x-stainless-os": "Linux",
      "x-stainless-arch": "x64",
      "x-stainless-runtime": "node",
      "x-stainless-runtime-version": "v24.9.0",
      "authorization": "Bearer csk-f3e6y5t8ppf6h565dhpj3end2n82tdr95pp65m3xtx9vvnmc",
      "x-stainless-retry-count": "0",
      "x-stainless-timeout": "15",
      "accept-encoding": "gzip,deflate",
      "host": "localhost:8080",
      "connection": "keep-alive"
    },
    "body": {
      "model": "qwen-3-coder-480b",
      "messages": [
        {
          "role": "system",
          "content": "You are a helpful AI assistant with access to bash and file search tools.\n\nUse the tools available to help the user accomplish their tasks.\n\n\n\nCRITICAL INSTRUCTION - CONTEXT AND EXPLANATION REQUIREMENTS:\n\n- Give as much context as possible in your responses. It is ALWAYS better to add too much context than too little.\n\n- Use file references with line numbers in the format: filename.ts:123 or path/to/file.py:456\n\n- Explain everything in an ultra explanatory tone, assuming the user needs complete understanding.\n\n- Include specific details: function names, variable names, code snippets, file paths with line numbers.\n\n- When referencing code, ALWAYS include the file path and line number where it can be found.\n\n- Provide thorough explanations of how things work, why they work that way, and what each piece does.\n\n- Word for word: \"Better to add too much context than necessary\" - follow this principle strictly.\n\n\n\nCRITICAL INSTRUCTION - MUST USE TOOLS TO GATHER INFORMATION:\n\n- You MUST use grep to search for information before answering questions about code.\n\n- You CANNOT rely on stored context or prior knowledge about the codebase.\n\n- Everything must be read using tools before giving an explanation.\n\n- This is to ensure that you do not lazily answer questions without verifying current state.\n\n- Always grep for relevant files, read the actual code, and then provide your explanation.\n\n- Never answer based solely on assumptions or memory - always verify with tools first."
        },
        {
          "role": "user",
          "content": "Previous conversation context:\n\n- User asked: Analyze the complete architecture of the system → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Grep → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Grep → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Bash → Assistant used tools: Grep → Assistant used tools: Bash\n\n[Conversation compacted. Continuing from recent context:]"
        },
        {
          "role": "assistant",
          "tool_calls": [
            {
              "id": "4440a8804",
              "type": "function",
              "function": {
                "name": "Bash",
                "arguments": "{\"command\":\"grep -n -A 5 -B 5 \\\"@anthropic-ai/sdk\\\" claude-code-template/query.ts\"}"
              }
            }
          ],
          "content": "Let's check the imports from the Anthropic SDK:"
        },
        {
          "role": "tool",
          "tool_call_id": "4440a8804",
          "content": "1-import {                                                                      \n2-  Message as APIAssistantMessage,                                             \n3-  MessageParam,                                                               \n4-  ToolUseBlock,                                                               \n5:} from '@anthropic-ai/sdk/resources/index.mjs'                                \n6-import { UUID } from 'crypto'                                                 \n7-import type { Tool, ToolContext } from './Tool.js'                            \n8-import {                                                                      \n9-  messagePairValidForBinaryFeedback,                                          \n10-  shouldUseBinaryFeedback,"
        },
        {
          "role": "assistant",
          "tool_calls": [
            {
              "id": "d07b619da",
              "type": "function",
              "function": {
                "name": "Bash",
                "arguments": "{\"command\":\"npm view @anthropic-ai/sdk types\"}"
              }
            }
          ],
          "content": "Let's check the Anthropic SDK documentation or types to understand ToolUseBlock:"
        },
        {
          "role": "tool",
          "tool_call_id": "d07b619da",
          "content": "./index.d.ts"
        },
        {
          "role": "assistant",
          "tool_calls": [
            {
              "id": "db8272654",
              "type": "function",
              "function": {
                "name": "Bash",
                "arguments": "{\"command\":\"node -e \\\"import('@anthropic-ai/sdk/resources/index.mjs').then(module => console.log(Object.keys(module)))\\\"\"}"
              }
            }
          ],
          "content": "Let's look at the Anthropic SDK types to understand ToolUseBlock:"
        },
        {
          "role": "tool",
          "tool_call_id": "db8272654",
          "content": "[ 'Beta', 'Completions', 'Messages', 'Models' ]"
        },
        {
          "role": "assistant",
          "tool_calls": [
            {
              "id": "b72c716c1",
              "type": "function",
              "function": {
                "name": "Bash",
                "arguments": "{\"command\":\"find node_modules/@anthropic-ai/sdk -name \\\"*.d.ts\\\" -exec grep -l \\\"ToolUseBlock\\\" {} \\\\;\"}"
              }
            }
          ],
          "content": "Let's check if we can find the ToolUseBlock type definition in the node_modules:"
        },
        {
          "role": "tool",
          "tool_call_id": "b72c716c1",
          "content": "node_modules/@anthropic-ai/sdk/client.d.ts                                      \nnode_modules/@anthropic-ai/sdk/lib/BetaMessageStream.d.ts                       \nnode_modules/@anthropic-ai/sdk/lib/MessageStream.d.ts                           \nnode_modules/@anthropic-ai/sdk/resources/index.d.ts                             \nnode_modules/@anthropic-ai/sdk/resources/beta/beta.d.ts                         \nnode_modules/@anthropic-ai/sdk/resources/beta/index.d.ts                        \nnode_modules/@anthropic-ai/sdk/resources/beta/messages/index.d.ts               \nnode_modules/@anthropic-ai/sdk/resources/beta/messages/messages.d.ts            \nnode_modules/@anthropic-ai/sdk/resources/messages/index.d.ts                    \nnode_modules/@anthropic-ai/sdk/resources/messages/messages.d.ts"
        },
        {
          "role": "assistant",
          "tool_calls": [
            {
              "id": "57f3ff605",
              "type": "function",
              "function": {
                "name": "Bash",
                "arguments": "{\"command\":\"grep -n -A 10 -B 5 \\\"ToolUseBlock\\\" node_modules/@anthropic-ai/sdk/resources/messages/messages.d.ts\"}"
              }
            }
          ],
          "content": "Let's examine the ToolUseBlock definition in the messages.d.ts file:"
        },
        {
          "role": "tool",
          "tool_call_id": "57f3ff605",
          "content": "aUsage as MessageDeltaUsage, type MessageParam as MessageParam, type MessageToke\nnsCount as MessageTokensCount, type Metadata as Metadata, type Model as Model, t\nype PlainTextSource as PlainTextSource, type RawContentBlockDelta as RawContentB\nlockDelta, type RawContentBlockDeltaEvent as RawContentBlockDeltaEvent, type Raw\nContentBlockStartEvent as RawContentBlockStartEvent, type RawContentBlockStopEve\nnt as RawContentBlockStopEvent, type RawMessageDeltaEvent as RawMessageDeltaEven\nt, type RawMessageStartEvent as RawMessageStartEvent, type RawMessageStopEvent a\ns RawMessageStopEvent, type RawMessageStreamEvent as RawMessageStreamEvent, type\n RedactedThinkingBlock as RedactedThinkingBlock, type RedactedThinkingBlockParam\n as RedactedThinkingBlockParam, type SearchResultBlockParam as SearchResultBlock\nParam, type ServerToolUsage as ServerToolUsage, type ServerToolUseBlock as Serve\nrToolUseBlock, type ServerToolUseBlockParam as ServerToolUseBlockParam, type Sig\nnatureDelta as SignatureDelta, type StopReason as StopReason, type TextBlock as \nTextBlock, type TextBlockParam as TextBlockParam, type TextCitation as TextCitat\nion, type TextCitationParam as TextCitationParam, type TextDelta as TextDelta, t\nype ThinkingBlock as ThinkingBlock, type ThinkingBlockParam as ThinkingBlockPara\nm, type ThinkingConfigDisabled as ThinkingConfigDisabled, type ThinkingConfigEna\nbled as ThinkingConfigEnabled, type ThinkingConfigParam as ThinkingConfigParam, \ntype ThinkingDelta as ThinkingDelta, type Tool as Tool, type ToolBash20250124 as\n ToolBash20250124, type ToolChoice as ToolChoice, type ToolChoiceAny as ToolChoi\nceAny, type ToolChoiceAuto as ToolChoiceAuto, type ToolChoiceNone as ToolChoiceN\none, type ToolChoiceTool as ToolChoiceTool, type ToolResultBlockParam as ToolRes\nultBlockParam, type ToolTextEditor20250124 as ToolTextEditor20250124, type ToolT\nextEditor20250429 as ToolTextEditor20250429, type ToolTextEditor20250728 as Tool\nTextEditor20250728, type ToolUnion as ToolUnion, type ToolUseBlock as ToolUseBlo\nck, type ToolUseBlockParam as ToolUseBlockParam, type URLImageSource as URLImage\nSource, type URLPDFSource as URLPDFSource, type Usage as Usage, type WebSearchRe\nsultBlock as WebSearchResultBlock, type WebSearchResultBlockParam as WebSearchRe\nsultBlockParam, type WebSearchTool20250305 as WebSearchTool20250305, type WebSea\nrchToolRequestError as WebSearchToolRequestError,"
        }
      ],
      "temperature": 0.7,
      "top_p": 0.8,
      "tools": [
        {
          "type": "function",
          "function": {
            "name": "Bash",
            "description": "Tool: Bash",
            "parameters": {
              "type": "object",
              "properties": {
                "command": {
                  "type": "string",
                  "description": "The command to execute"
                },
                "timeout": {
                  "type": "number",
                  "description": "Optional timeout in milliseconds (max 600000)"
                }
              },
              "required": [
                "command"
              ],
              "additionalProperties": false
            }
          }
        },
        {
          "type": "function",
          "function": {
            "name": "Grep",
            "description": "Tool: Grep",
            "parameters": {
              "type": "object",
              "properties": {
                "pattern": {
                  "type": "string",
                  "description": "The regular expression pattern to search for in file contents"
                },
                "path": {
                  "type": "string",
                  "description": "The directory to search in. Defaults to the current working directory."
                },
                "include": {
                  "type": "string",
                  "description": "File pattern to include in the search (e.g. \"*.ts\", \"*.{ts,tsx}\")"
                }
              },
              "required": [
                "pattern"
              ],
              "additionalProperties": false
            }
          }
        }
      ],
      "tool_choice": "auto"
    },
    "bodySize": 12493
  },
  "response": {
    "status": 200,
    "headers": {
      "date": "Fri, 24 Oct 2025 18:53:09 GMT",
      "content-type": "application/json",
      "transfer-encoding": "chunked",
      "connection": "keep-alive",
      "server": "cloudflare",
      "x-request-id": "993bace42963a38b-ATL",
      "x-ratelimit-limit-requests-day": "172800",
      "x-ratelimit-limit-tokens-minute": "1500000",
      "x-ratelimit-remaining-requests-day": "170651",
      "x-ratelimit-remaining-tokens-minute": "1481467",
      "x-ratelimit-reset-requests-day": "18410.662986516953",
      "x-ratelimit-reset-tokens-minute": "50.662986516952515",
      "inference-id": "chatcmpl-35b93a00-267f-4bcc-a031-85edbc4f2514",
      "referrer-policy": "strict-origin-when-cross-origin",
      "x-content-type-options": "nosniff",
      "strict-transport-security": "max-age=3600; includeSubDomains",
      "cf-cache-status": "DYNAMIC",
      "set-cookie": "__cf_bm=rw9blkbO9sOyaAOUou5s75hJ5JFj0N0_DHugR1Mptvo-1761331989.144578-1.0.1.1-qzuPCQYNDiO.wVzQlVD0SYJqu_jiuJsKlhm.Gd9YZfVH7Jckea.zW8CdDSaJWm5yluYMeYBn_.prcdD8i0ufyLw1RYq_Hs9wWHKnYpCvUf0v2zX2GI2AIHI3yRws4Pyo; HttpOnly; Secure; Path=/; Expires=Fri, 24 Oct 2025 19:23:09 GMT",
      "cf-ray": "993bace42963a38b-ATL",
      "alt-svc": "h3=\":443\"; ma=86400"
    },
    "body": {
      "id": "chatcmpl-35b93a00-267f-4bcc-a031-85edbc4f2514",
      "choices": [
        {
          "finish_reason": "tool_calls",
          "index": 0,
          "message": {
            "content": "Let's get the specific definition of ToolUseBlock:\n\n",
            "tool_calls": [
              {
                "id": "0fae9a8ec",
                "type": "function",
                "function": {
                  "name": "Bash",
                  "arguments": "{\"command\": \"grep -n -A 20 \\\"export interface ToolUseBlock\\\" node_modules/@anthropic-ai/sdk/resources/messages/messages.d.ts\"}"
                }
              }
            ],
            "role": "assistant"
          }
        }
      ],
      "created": 1761331989,
      "model": "qwen-3-coder-480b",
      "system_fingerprint": "fp_386b539e7b02ce3613b7",
      "object": "chat.completion",
      "usage": {
        "prompt_tokens": 2567,
        "completion_tokens": 60,
        "total_tokens": 2627,
        "prompt_tokens_details": {
          "cached_tokens": 0
        }
      },
      "time_info": {
        "queue_time": 0.000984607,
        "prompt_time": 0.042022356,
        "completion_time": 0.03064091,
        "total_time": 0.07526302337646484,
        "created": 1761331989.2285254
      }
    },
    "duration": 440
  }
}